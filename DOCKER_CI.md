# Docker CI/CD Setup

This repository includes automated Docker image building and publishing workflows.

## GitHub Container Registry (Recommended)

The main workflow (`docker-build-push.yml`) automatically:
- Builds Docker images on every push to `main` and on pull requests
- Pushes images to GitHub Container Registry (`ghcr.io`) 
- Creates multi-architecture images (AMD64 and ARM64)
- Uses GitHub's built-in caching for faster builds

### Image Tags
- `main` branch pushes → `ghcr.io/aaronaddleman/easy-mkdocs:main` and `latest`
- Version tags (e.g., `v1.0.0`) → `ghcr.io/aaronaddleman/easy-mkdocs:1.0.0` and `1.0`
- Pull requests → `ghcr.io/aaronaddleman/easy-mkdocs:pr-<number>`

### Setup Required
✅ **No setup required** - `GITHUB_TOKEN` is automatically provided by GitHub Actions

> **Note**: The `GITHUB_TOKEN` is automatically generated by GitHub for every workflow run. You don't need to create or configure anything!

## Docker Hub (Alternative)

The alternative workflow (`docker-hub.yml`) pushes to Docker Hub instead.

### Setup Required for Docker Hub
1. Create a Docker Hub account and repository
2. Generate a Docker Hub access token
3. Add these secrets to your GitHub repository settings:
   - `DOCKERHUB_USERNAME`: Your Docker Hub username
   - `DOCKERHUB_TOKEN`: Your Docker Hub access token

### To Use Docker Hub Instead
1. Delete or rename `docker-build-push.yml`
2. Rename `docker-hub.yml` to `docker-build-push.yml`
3. Add the required secrets

## Usage

### Triggering Builds
- **Automatic**: Push to `main` branch or create a pull request
- **Manual**: Create a release with a version tag (e.g., `v1.0.0`)

### Running the Built Image
```bash
# From GitHub Container Registry
docker run -p 8000:8000 ghcr.io/aaronaddleman/easy-mkdocs:latest

# From Docker Hub (if configured)
docker run -p 8000:8000 yourusername/easy-mkdocs:latest
```

## Multi-Architecture Support
Images are built for both:
- `linux/amd64` (Intel/AMD x86_64)
- `linux/arm64` (Apple Silicon, ARM servers)

## FAQ

### Do I need to create a GITHUB_TOKEN?
**No!** The `GITHUB_TOKEN` is automatically provided by GitHub Actions for every workflow run. GitHub automatically:
1. Creates a temporary token with the necessary permissions
2. Makes it available as `${{ secrets.GITHUB_TOKEN }}`
3. Gives it access to push to GitHub Container Registry (`ghcr.io`)

### What permissions does the workflow need?
The workflow requests these permissions in the YAML file:
- `contents: read` - To checkout your repository code
- `packages: write` - To push Docker images to GitHub Container Registry

### How do I enable the workflow?
Just commit and push the workflow file to your repository. GitHub Actions will automatically:
1. Detect the `.github/workflows/` files
2. Run the workflow on the next push to `main`
3. Handle all authentication automatically
